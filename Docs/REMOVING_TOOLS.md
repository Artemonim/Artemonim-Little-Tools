# Как удалять инструменты из LittleTools

Это руководство объясняет, как удалять существующие инструменты из набора LittleTools. Процесс удаления всегда состоит из двух основных шагов:

1.  **Дерегистрация инструмента:** Удаление записи о нем из конфигурационных файлов.
2.  **Удаление исходного кода:** Удаление файлов или фрагментов кода, реализующих инструмент.

---

## Шаг 1: Определите, как инструмент интегрирован

Прежде чем что-то удалять, нужно понять, как инструмент был добавлен. Откройте `Docs/ADDING_NEW_TOOLS.md` и сопоставьте ваш случай с одним из сценариев:

-   **Сценарий 1A: Простая команда в существующем файле.** Функция `@app.command()` добавлена в общий файл типа `video_converter.py`.
-   **Сценарий 1B: Комплексная команда в новом файле.** Был создан отдельный файл `.py` внутри пакета (как `ben2_remover.py`) и прописан в `pyproject.toml` этого пакета.
-   **Сценарий 2: Целый пакет-инструмент.** Была создана целая директория `littletools_themename` и добавлена в `start.ps1`.

## Шаг 2: Выполните удаление согласно сценарию

### Удаление по сценарию 1A (Простая команда)

Это самый легкий случай.

1.  **Найдите файл:** Перейдите в папку пакета (например, `littletools_video/littletools_video/`) и откройте файл, содержащий вашу команду (например, `video_converter.py`).
2.  **Удалите код:** Найдите и полностью удалите функцию Python, реализующую команду (блок кода, начинающийся с `@app.command()`).

Вот и все! Никаких других правок не требуется.

### Удаление по сценарию 1B (Комплексная команда)

Здесь на один шаг больше.

1.  **Дерегистрация:** Откройте `pyproject.toml` пакета, в котором находится инструмент (например, `littletools_video/pyproject.toml`).
    -   Найдите секцию `[project.entry-points."littletools.commands"]` и удалите строку, относящуюся к вашему инструменту.
    -   Найдите секцию `[project.scripts]` и также удалите оттуда соответствующую строку.
    -   Если для этого инструмента добавлялись специфичные зависимости в секцию `dependencies`, удалите их, чтобы не хранить лишнего.
2.  **Удаление файла:** Удалите сам файл `.py` с кодом инструмента (например, `littletools_video/littletools_video/my_watermark_tool.py`).
3.  **(Обязательно) Проверка и очистка зависимостей:** После удаления кода обязательно проверьте `pyproject.toml` на наличие "осиротевших" зависимостей. См. секцию "Очистка неиспользуемых зависимостей" ниже.

После этого запустите `start.bat` или `start.ps1`, чтобы изменения вступили в силу.

### Удаление по сценарию 2 (Целый пакет)

Это полное удаление целой категории инструментов.

1.  **Дерегистрация пакета:**
    -   Откройте `start.ps1` в корне проекта.
    -   Найдите строку `& $VenvPython -m pip install ...`.
    -   Удалите из этой строки флаг для вашего пакета (например, `-e ./littletools_archive`).
2.  **Удаление папки:** Полностью удалите директорию вашего пакета (например, `littletools_archive`).
3.  **(Рекомендуется) Очистка окружения:** Удалите папку `.venv` и запустите `start.bat` или `start.ps1`, чтобы пересобрать окружение с чистого листа.

---

## Очистка неиспользуемых зависимостей (Важный шаг!)

После удаления кода из пакета (особенно по сценариям 1B и 2) крайне важно проверить, не остались ли в `pyproject.toml` зависимости, которые больше не используются.

1.  **Сгенерируйте актуальные зависимости:** Запустите из корня проекта скрипт `requirementsBuilder.py`, указав ему путь к исходникам вашего пакета.

    ```bash
    # Замените <path-to-package-source> на актуальный путь
    # например, littletools_video/littletools_video
    python requirementsBuilder.py -d <path-to-package-source>
    ```

    Когда скрипт спросит, создавать ли `.gitignore` или устанавливать ли пакеты, можно ответить `n` (нет). Он создаст в указанной папке файл `requirements.txt`.

2.  **Сравните списки:**

    -   Откройте созданный `requirements.txt`. В нем перечислены модули, которые _действительно_ импортируются в коде.
    -   Откройте `pyproject.toml` вашего пакета и посмотрите на список `dependencies`.

3.  **Удалите лишнее:** Если в `pyproject.toml` есть зависимость, которой нет в `requirements.txt`, и вы уверены, что она больше не нужна ни одному из оставшихся инструментов в пакете, — смело удаляйте её строку из `pyproject.toml`.

> **? Примечание:** Скрипт `requirementsBuilder.py` не идеален и может не увидеть некоторые динамические импорты. Однако он отлично подходит для обнаружения очевидных "сирот", таких как `torch` или `ben2` после удаления использовавшего их кода.

После выполнения этих шагов инструмент будет полностью удален из проекта.
